{% extends "base.html" %}
{% block content %}

<!-- Versteckter Hauptcontent (wird nach Animation gezeigt) -->
<div id="main-content" style="display: none;">
    <div style="text-align: center;">
        <h1>🎉 Spiel Beendet!</h1>
        <h2>{{ company.owner_name }}'s Endergebnis</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 30px 0;">
            <div style="background: #e9ecef; padding: 20px; border-radius: 10px; text-align: center;">
                <h3>🏆 Endpunktzahl</h3>
                <p style="font-size: 2em; font-weight: bold; color: #007bff;">{{ "{:,}".format(final_score) }}</p>
            </div>
            <div style="background: #e9ecef; padding: 20px; border-radius: 10px; text-align: center;">
                <h3>💰 Endkontostand</h3>
                <p style="font-size: 1.5em;">{{ "{:,}".format(company.balance) }} CHF</p>
            </div>
            <div style="background: #e9ecef; padding: 20px; border-radius: 10px; text-align: center;">
                <h3>👥 Kunden</h3>
                <p style="font-size: 1.5em;">{{ company.customers }}</p>
            </div>
            <div style="background: #e9ecef; padding: 20px; border-radius: 10px; text-align: center;">
                <h3>👨‍💼 Mitarbeiter</h3>
                <p style="font-size: 1.5em;">{{ company.employees }}</p>
            </div>
            <div style="background: #e9ecef; padding: 20px; border-radius: 10px; text-align: center;">
                <h3>⭐ Reputation</h3>
                <p style="font-size: 1.5em;">{{ "%.1f"|format(company.reputation) }}</p>
            </div>
            <div style="background: #e9ecef; padding: 20px; border-radius: 10px; text-align: center;">
                <h3>📈 Produktqualität</h3>
                <p style="font-size: 1.5em;">{{ "%.1f"|format(company.product_quality) }}</p>
            </div>
        </div>
        
        {% if company.months_survived >= 12 and not company.is_bankrupt %}
        <div style="background: #d4edda; padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid #c3e6cb;">
            <h3>🎊 Herzlichen Glückwunsch!</h3>
            <p style="font-size: 1.2em;">Du hast alle 12 Monate in St. Gallen überlebt! Dein Erfolg wird ins Leaderboard eingetragen!</p>
        </div>
        {% elif company.is_bankrupt %}
        <div style="background: #f8d7da; padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid #f5c6cb;">
            <h3>💀 Bankrott!</h3>
            <p style="font-size: 1.2em;">Leider ist dein Startup bankrott gegangen. Nur erfolgreiche Unternehmer schaffen es ins Leaderboard!</p>
        </div>
        {% else %}
        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid #ffeaa7;">
            <h3>⏰ Zu früh beendet!</h3>
            <p style="font-size: 1.2em;">Du hast nicht alle 12 Monate geschafft. Nur wer das ganze Jahr überlebt, kommt ins Leaderboard!</p>
        </div>
        {% endif %}
        
        <div style="text-align: center; margin-top: 30px;">
            <p style="font-size: 1.1em; margin-bottom: 20px;">Du wirst in <span id="countdown">8</span> Sekunden automatisch zum Leaderboard weitergeleitet...</p>
            <a href="/leaderboard" class="btn" style="font-size: 18px; padding: 15px 30px;">Sofort zum Leaderboard</a>
        </div>
    </div>
</div>

<!-- Game Over Animation wird hier eingefügt -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Warte kurz bis alles geladen ist
    setTimeout(() => {
        // Zeige Game Over Animation
        showGameOverAnimation();
    }, 200);
});

function showGameOverAnimation() {
    // Erstelle Game Over Overlay
    const overlay = document.createElement('div');
    overlay.className = 'go-overlay is-open';
    overlay.innerHTML = `
        <div class="go-card">
            <h1 class="go-title">
                GAME OVER
                <span class="glitch">GAME OVER</span>
            </h1>
            <p class="go-sub">{{ company.owner_name }}'s St. Gallen Adventure ist zu Ende!</p>
            
            <div class="go-pill" style="display: flex;">
                <span class="go-dot"></span>
                <span>Endpunktzahl: <strong>{{ "{:,}".format(final_score) }}</strong></span>
            </div>
            
            <div class="go-actions">
                <button class="go-btn primary" onclick="showResults()">Ergebnisse anzeigen</button>
                <button class="go-btn" onclick="goToLeaderboard()">Zum Leaderboard</button>
            </div>
        </div>
    `;
    
    document.body.appendChild(overlay);
    document.documentElement.style.overflow = 'hidden';
}

function showResults() {
    // Verstecke Animation
    const overlay = document.querySelector('.go-overlay');
    if (overlay) {
        overlay.classList.remove('is-open');
        setTimeout(() => overlay.remove(), 300);
    }
    document.documentElement.style.overflow = '';
    
    // Zeige Hauptcontent
    document.getElementById('main-content').style.display = 'block';
    
    // Starte Countdown für Leaderboard
    startCountdown();
}

function goToLeaderboard() {
    window.location.href = '/leaderboard';
}

function startCountdown() {
    let countdown = 8;
    const countdownElement = document.getElementById('countdown');
    
    const timer = setInterval(() => {
        countdown--;
        if (countdownElement) {
            countdownElement.textContent = countdown;
        }
        if (countdown <= 0) {
            clearInterval(timer);
            window.location.href = '/leaderboard';
        }
    }, 1000);
    
    // Automatische Weiterleitung nach 8 Sekunden
    setTimeout(() => {
        window.location.href = '/leaderboard';
    }, 8000);
}

// Automatisch Animation nach 4 Sekunden ausblenden (falls Nutzer nicht klickt)
setTimeout(() => {
    const overlay = document.querySelector('.go-overlay');
    if (overlay && overlay.classList.contains('is-open')) {
        showResults();
    }
}, 4000);
</script>

{% endblock %}
